<a routerLink="/" class="back-link">Back to incidents</a>

@if (error(); as message) {
  <p class="error">{{ message }}</p>
}

@if (incident(); as current) {
  <section class="panel">
    <h1>{{ current.title }}</h1>
    <p>{{ current.description }}</p>
    <p><strong>Status:</strong> {{ current.status }}</p>
    <p><strong>Priority:</strong> {{ current.priority }}</p>
    <p><strong>Location:</strong> {{ current.location }}</p>
  </section>

  <section class="panel">
    <h2>Upload Evidence Image</h2>
    <form [formGroup]="uploadForm" (ngSubmit)="requestUploadUrl()" class="form-grid">
      <label>
        File name
        <input formControlName="fileName" placeholder="scene-01.jpg" />
      </label>

      <label>
        Content type
        <input formControlName="contentType" />
      </label>

      <button type="submit">Generate URL</button>
    </form>

    <div class="upload-actions">
      <label>
        Select image
        <input type="file" accept="image/*" (change)="onFileSelected($event)" />
      </label>
      <button type="button" (click)="uploadSelectedFile()" [disabled]="uploadInProgress()">
        {{ uploadInProgress() ? 'Uploading...' : 'Upload Selected Image' }}
      </button>
    </div>

    @if (selectedFileName(); as fileName) {
      <p class="upload-meta">
        Selected: <strong>{{ fileName }}</strong>
        @if (selectedContentType(); as type) {
          <span> ({{ type }})</span>
        }
      </p>
    }

    @if (uploadResult(); as url) {
      <p class="upload-url">Generated URL: <code>{{ url }}</code></p>
    }

    @if (uploadStatus(); as status) {
      <p class="upload-status">{{ status }}</p>
    }
  </section>

  <section class="panel">
    <h2>Queue Processing</h2>
    <form [formGroup]="processForm" (ngSubmit)="queueProcessing()" class="form-grid">
      <label>
        Reason
        <input formControlName="reason" />
      </label>

      <button type="submit">Queue</button>
    </form>
  </section>

  <section class="panel">
    <h2>Evidence</h2>
    @if (current.evidence.length === 0) {
      <p>No evidence yet.</p>
    } @else {
      <ul>
        @for (item of current.evidence; track item.objectKey) {
          <li>
            <strong>{{ item.fileName }}</strong>
            <span>{{ item.objectKey }}</span>
          </li>
        }
      </ul>
    }
  </section>
}
